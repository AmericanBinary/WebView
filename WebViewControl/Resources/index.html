<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
	<script>
		window.showErrorMessage = function (msg) {
			const ContainerId = "webview_error";
			let msgContainer = document.getElementById(ContainerId);
			if (!msgContainer) {
				msgContainer = document.createElement("div");
				msgContainer.id = ContainerId;
				msgContainer.style.backgroundColor = "#f45642";
				msgContainer.style.color = "white";
				msgContainer.style.fontFamily = "Arial";
				msgContainer.style.fontWeight = "bold";
				msgContainer.style.fontSize = "10px"
				msgContainer.style.padding = "3px";
				msgContainer.style.position = "absolute";
				msgContainer.style.top = "0";
				msgContainer.style.left = "0";
				msgContainer.style.right = "0";
				document.body.appendChild(msgContainer);
			}
			msgContainer.innerText = msg;
		};
	</script>
	<script src="node_modules/requirejs/require.js"></script>
    <script>
		(function () {
			const UrlParams = location.search.substring(1).split("&");
			const UseEnhancedRenderingEngine = UrlParams[0] === "1";
			const LibsPath = UrlParams[1];
			const RootObjectName = UrlParams[2];
			const RootPropertiesName = UrlParams[3];
			const EventlistenerObjectName = UrlParams[4];
			const ReadyEventName = UrlParams[5];

			let paths;

			if (UseEnhancedRenderingEngine) {
				// load preact
				paths = {
					"prop-types": LibsPath + "prop-types/prop-types.min",
					"react": LibsPath + "preact-compat/dist/preact-compat.min",
				};

				define("preact", [LibsPath + "preact/dist/preact.min.js"], function () {
					// export preact as a module
					return window.preact;
				});

				define("react-dom", ["react"], function (react) {
					// export react-dom as a module
					return react;
				});
			} else {
				// load react
				paths = {
					"react": LibsPath + "react/dist/react.min",
					"react-dom": LibsPath + "react-dom/dist/react-dom.min",
				};
			}

			require.config({
				paths: paths,
				map: {
					'*': {
						'css': LibsPath + "require-css/css.min.js"
					}
				}
			});

			require(["react", "react-dom"]); // preload react

			window.load = function (baseUrl, userComponent, additionalModule, userDefaultStylesheet) {
				require.config({
					baseUrl: baseUrl
				});

				if (userDefaultStylesheet) {
					userDefaultStylesheet = "css!" + userDefaultStylesheet;
				}

				var baseElement = document.createElement("base");
				baseElement.href = baseUrl;
				document.head.appendChild(baseElement); // let images and other resources load from the appropriate path

				require(["react", "react-dom", userComponent, additionalModule, userDefaultStylesheet], function (React, ReactDOM, WebViewComponentModule) {
					let WebViewComponent = WebViewComponentModule.default;
					CefSharp.BindObjectAsync(RootPropertiesName, RootPropertiesName).then(() => {
						window[RootObjectName] = ReactDOM.render(
							React.createElement(WebViewComponent, window[RootPropertiesName]),
							document.getElementById("webview_root"),
							() => notifyReady()
						);
					});
				});

				function notifyReady() {
					CefSharp.BindObjectAsync(EventlistenerObjectName, EventlistenerObjectName).then(() => {
						window[EventlistenerObjectName].notify(ReadyEventName);
					});
				}
			}
		})();
    </script>
</head>
<body>
    <div id="webview_root"></div>
</body>
</html>